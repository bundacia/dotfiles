#!/bin/zsh

start_app() {
  tmux send-keys -t stack 'git pull; bundle; STEPFORD_LOCAL=true fs' C-m
}

# Create new session for stack
tmux new-session -P -d -c ~/work/deals -s stack -n deals 

# Start dependencies in new windows
for app in accounts browse sso-frontend deal_bucks deals-service stepford catalog-service payments pixels; do
  tmux new-window -t stack -n $app -c ~/work/$app && start_app
done

# Start deals in first window
tmux send-keys -t stack:deals 'git pull; bundle; STEPFORD_LOCAL=true fs' C-m

# Link deals window to "ls" session
tmux link-window -s stack:deals -t ls
tmux link-window -s stack:catalog-service -t ls
